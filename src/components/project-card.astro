---
import { ExternalLink } from "@lucide/astro";
import type { IProject } from "../schemas/content";
import Pill from "./pill.astro";
import { tw } from "../utils/merge";
import { parsePreviewUrl } from "../utils/parser";

type Props = IProject;

const { name, description, link, technologies, discontinued } = Astro.props;
---

<div
  class={tw(
    "group bg-card border rounded-lg p-5 hover:border-primary/50 transition-colors relative border-border",
    { "border-yellow-500/50": discontinued }
  )}
>
  <!-- {
    discontinued && (
      <span class="absolute top-3 left-3 rounded-md border border-yellow-500/30 bg-yellow-500/10 px-2 py-1 text-xs text-yellow-500">
        Discontinued
      </span>
    )
  } -->

  <div
    class={tw("flex items-start justify-between gap-4 mb-3", {
      // "pt-6": discontinued,
    })}
  >
    <div class="flex-1">
      {
        !link && (
          <h3 class="group-hover:text-primary text-lg font-semibold transition-colors">
            {name}
          </h3>
        )
      }
      {
        link && (
          <>
            <a
              class="group-hover:text-primary text-lg font-semibold transition-colors"
              href={link}
              target="_blank"
            >
              {name}
            </a>
            <p class="text-muted-foreground/70 mt-1 text-xs">
              {parsePreviewUrl(link)}
            </p>
          </>
        )
      }
    </div>
    {
      !!link && (
        <a
          href={link}
          target="_blank"
          rel="noopener noreferrer"
          class="text-muted-foreground hover:text-primary flex-shrink-0 transition-colors"
          aria-label={`View ${name} project`}
        >
          <ExternalLink class="h-4 w-4" />
        </a>
      )
    }
  </div>
  <p class="text-muted-foreground mb-4 text-sm leading-relaxed">
    {description}
  </p>

  <div class="flex flex-wrap gap-2">
    {
      technologies.map((tech) => {
        return <Pill name={tech} />;
      })
    }
  </div>
</div>
